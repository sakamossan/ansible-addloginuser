---
- hosts: localdev
  remote_user: vagrant
  become: true

  vars:
    # sudoers role
    sudoers_filename: "{{ username }}"
    sudoers_nopasswd: true
    sudoers:
      - name: "{{ username }}"
        users: [ "ALL" ]
  tasks:
    - name: create group
      group:
        name: "{{ username }}"
        gid: 510
        state: present
    - name: create user
      user:
        name: "{{ username }}"
        append: true
        createhome: true
        groups: adm,{{ username }}
        shell: /bin/bash
        password: '!!'
        uid: 510
    - name: set authorized_keys
      authorized_key:
        user: "{{ username }}"
        state: present
        # need to prepare: ssh-keygen -t rsa -b 4096 -C {{ mail }} -f ~/.ssh/{{ appname }}-id_rsa
        key: "{{ lookup('file', '~/.ssh/{{ username }}-id_rsa.pub') }}"
  roles:
    - ansible-sudoers
